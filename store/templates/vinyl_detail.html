{% extends 'base.html' %}
{% block content %}

<div class="container mt-5">
  <div class="row">

    <!-- Cover levá strana -->
    <div class="col-md-5">
      <img src="{{ vinyl.cover_image.url }}" class="img-fluid rounded shadow">
    </div>

    <!-- Informace v pravo -->
    <div class="col-md-7">
      <h2>{{ vinyl.title }}</h2>
      <p class="text-muted">{{ vinyl.artist.name }}</p>

      <p>{{ vinyl.description }}</p>

      {% if vinyl.tracklist %}
        <h5 class="mt-4">Tracklist</h5>
        <pre class="bg-light p-3 rounded tracklist-box">
  {{ vinyl.tracklist }}
        </pre>
      {% endif %}

      <h4 class="mt-4">{{ vinyl.price }} Kč</h4>

      <p class="mt-2">
        ⭐ {{ vinyl.avg_rating|floatformat:1 }} / 5
        ({{ vinyl.ratings.count }} hodnocení)
      </p>

      <a href="{% url 'vinyl_list' %}" class="btn btn-outline-secondary mt-3">
        ← Zpět na vinyly
      </a>
    </div>

  </div>

  <!-- Hodnocení -->
  <hr class="my-5">

  <h4>Recenze</h4>

  {% for rating in ratings %}
    <div class="border rounded p-3 mb-3">
      <strong>{{ rating.user.username }}</strong>
      <span class="ms-2">
        {% for i in "12345" %}
          {% if forloop.counter <= rating.stars %}
            ⭐
          {% else %}
            ☆
          {% endif %}
        {% endfor %}
      </span>
      {% if rating.comment %}
        <p class="mt-2 mb-0">{{ rating.comment }}</p>
      {% endif %}
    </div>
  {% empty %}
    <p class="text-muted">Zatím žádné recenze.</p>
  {% endfor %}

  <!-- Přidávání hodnocení-->
  {% if user.is_authenticated %}
    <hr>
    <h5>Přidat recenzi</h5>

    <form method="post" class="mt-3">
      {% csrf_token %}
      
      <div class="mb-3">
        {{ form.stars.label_tag }}
        {{ form.stars }}
      </div>

      <div class="mb-3">
        {{ form.comment.label_tag }}
        {{ form.comment }}
      </div>

      <button type="submit" class="btn btn-primary">
        Odeslat recenzi
      </button>
    </form>
  {% else %}
    <p class="mt-3">
      Pro přidání recenze se musíš
      <a href="{% url 'login' %}">přihlásit</a>.
    </p>
  {% endif %}

</div>

{% endblock %}